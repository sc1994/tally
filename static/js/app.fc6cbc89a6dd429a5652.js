webpackJsonp([1],{"/QhK":function(t,e){},"0Y+k":function(t,e){},"4yJi":function(t,e){},"6fDL":function(t,e){},"7/3/":function(t,e){},"7SuA":function(t,e){},E51W:function(t,e){},O1me:function(t,e){},"Orn+":function(t,e){},QGfW:function(t,e){},Qg0Z:function(t,e){},TGkL:function(t,e){},"V+li":function(t,e){},cAxO:function(t,e){},kLMm:function(t,e){},loy4:function(t,e){},"m/7z":function(t,e){},mhXF:function(t,e){},nULK:function(t,e){},ngqk:function(t,e,n){"use strict";var a=n("qsOD"),i=(n.n(a),n("yjky"));var o=function(t){n("O1me")},s=n("VU/8")(a.default,i.a,!1,o,null,null);e.default=s.exports},pePl:function(t,e){},qsOD:function(t,e){throw new Error('Module build failed: Error: Couldn\'t find preset "es2015" relative to directory "D:\\\\Self\\\\tally\\\\node_modules\\\\vue-core-image-upload"\n    at D:\\Self\\tally\\node_modules\\babel-core\\lib\\transformation\\file\\options\\option-manager.js:293:19\n    at Array.map (<anonymous>)\n    at OptionManager.resolvePresets (D:\\Self\\tally\\node_modules\\babel-core\\lib\\transformation\\file\\options\\option-manager.js:275:20)\n    at OptionManager.mergePresets (D:\\Self\\tally\\node_modules\\babel-core\\lib\\transformation\\file\\options\\option-manager.js:264:10)\n    at OptionManager.mergeOptions (D:\\Self\\tally\\node_modules\\babel-core\\lib\\transformation\\file\\options\\option-manager.js:249:14)\n    at OptionManager.init (D:\\Self\\tally\\node_modules\\babel-core\\lib\\transformation\\file\\options\\option-manager.js:368:12)\n    at File.initOptions (D:\\Self\\tally\\node_modules\\babel-core\\lib\\transformation\\file\\index.js:212:65)\n    at new File (D:\\Self\\tally\\node_modules\\babel-core\\lib\\transformation\\file\\index.js:135:24)\n    at Pipeline.transform (D:\\Self\\tally\\node_modules\\babel-core\\lib\\transformation\\pipeline.js:46:16)\n    at transpile (D:\\Self\\tally\\node_modules\\babel-loader\\lib\\index.js:50:20)\n    at Object.module.exports (D:\\Self\\tally\\node_modules\\babel-loader\\lib\\index.js:173:20)')},sq7P:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("7+uW"),i=n("NYxO"),o={name:"App",watch:{$route:function(t){"/sign"!=t.path&&this.$store.dispatch("initUser",{$router:this.$router})}},mounted:function(){navigator.userAgent.indexOf("iPhone")>0?this.$store.commit("changeAppbarStyle","top-van-backage-iphone"):this.$store.commit("changeAppbarStyle","top-van-backage-oneplus"),window.document.URL.indexOf("/sign")<0&&this.$store.dispatch("initUser",{$router:this.$router})}},s={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("router-view")],1)},staticRenderFns:[]};var r=n("VU/8")(o,s,!1,function(t){n("TGkL")},null,null).exports,l=n("/ocq"),c={data:function(){return{active:0,pwdErrorText:"",nameErrorText:"",loginModel:{username:"",password1:"",password2:"",remember:!0},usernameRules:[{validate:function(t){return!!t},message:"必须填写用户名"},{validate:function(t){return t.length>=3},message:"用户名长度大于2"}],passwordRules:[{validate:function(t){return!!t},message:"必须填写密码"},{validate:function(t){return t.length>5},message:"密码长度大于5"}]}},methods:{submit:function(){var t=this;t.$refs.form.validate().then(function(e){if(e)if(1!=t.active||t.loginModel.password1==t.loginModel.password2){if(!(t.nameErrorText.length>0)){var n=t.$loading();t.pwdErrorText="";var a=0==t.active?"/land/signin":"/land/signup";t.$axios.post(a,{name:t.loginModel.username,pwd:t.loginModel.password1,remember:t.loginModel.remember}).then(function(e){0==e.code&&(0==t.active?(t.$toast.success("登陆成功, 请稍后..."),setTimeout(function(){t.$router.push({path:"/"})},1200)):(t.$toast.success("注册成功, 请登录"),t.active=0)),n.close()}).catch(function(){n.close()})}}else t.pwdErrorText="两次输入的密码不一致"})},chenkName:function(){var t=this;if(0==t.active||t.loginModel.username.length<3)t.nameErrorText="";else{var e=t.$loading({});t.$axios.get("/signupcheck/"+t.loginModel.username).then(function(n){n.exist&&(t.nameErrorText="已存在的用户名"),e.close()}).catch(function(){e.close()})}}},watch:{active:function(t){this.$refs.form.clear(),this.loginModel.username.length<=2&&(this.loginModel.username=""),this.loginModel.password1="",this.loginModel.password2="",this.loginModel.remember=!0}}},u={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("mu-container",[n("mu-paper",{staticClass:"head-paper",attrs:{circle:"","z-depth":3}},[n("img",{staticClass:"head-img",attrs:{src:"/static/images/head-default.png"}})]),t._v(" "),n("mu-tabs",{attrs:{value:t.active,inverse:"",color:"#ff4081","text-color":"rgba(0, 0, 0, .54)","full-width":""},on:{"update:value":function(e){t.active=e}}},[n("mu-tab",[t._v("登 陆")]),t._v(" "),n("mu-tab",[t._v("注 册")])],1),t._v(" "),n("mu-form",{ref:"form",staticStyle:{height:"28px","margin-top":"36px"},attrs:{model:t.loginModel}},[n("mu-form-item",{attrs:{label:"用户名",prop:"username",rules:t.usernameRules}},[n("mu-text-field",{attrs:{"error-text":t.nameErrorText,prop:"username"},on:{blur:t.chenkName},model:{value:t.loginModel.username,callback:function(e){t.$set(t.loginModel,"username",e)},expression:"loginModel.username"}})],1),t._v(" "),n("mu-form-item",{attrs:{label:"密码",prop:"password1",rules:t.passwordRules}},[n("mu-text-field",{attrs:{type:"password",prop:"password"},model:{value:t.loginModel.password1,callback:function(e){t.$set(t.loginModel,"password1",e)},expression:"loginModel.password1"}})],1),t._v(" "),1==t.active?n("mu-form-item",{attrs:{label:"确认密码",prop:"password2",rules:t.passwordRules}},[n("mu-text-field",{attrs:{type:"password","error-text":t.pwdErrorText,prop:"password"},model:{value:t.loginModel.password2,callback:function(e){t.$set(t.loginModel,"password2",e)},expression:"loginModel.password2"}})],1):t._e(),t._v(" "),0==t.active?n("mu-form-item",{attrs:{prop:"remember"}},[n("mu-checkbox",{attrs:{label:"记住密码"},model:{value:t.loginModel.remember,callback:function(e){t.$set(t.loginModel,"remember",e)},expression:"loginModel.remember"}})],1):t._e(),t._v(" "),n("mu-form-item",[n("mu-button",{staticStyle:{width:"95%"},attrs:{round:"","full-width":"",color:"primary"},on:{click:t.submit}},[t._v("\n        "+t._s(1==t.active?"注 册":"登 陆")+"\n      ")])],1)],1)],1)},staticRenderFns:[]};var m=n("VU/8")(c,u,!1,function(t){n("xA82")},"data-v-5e61011b",null).exports,p=n("Dd8w"),h=n.n(p),d={props:{lefticon:{type:String},leftevent:{type:Function},letfstyle:{type:String},righticon:{type:String},rightevent:{type:Function,default:function(){}},rightstyle:{type:String}},data:function(){return{title:"",value:"",iconThree:":fa fa-user-circle-o",colorThree:""}},methods:{goto:function(t){this.$router.push({path:t})},init:function(){switch(this.$store.dispatch("initUnreadNumber"),this.$router.currentRoute.path){case"/":this.title="添加一笔";break;case"/tally":this.title="账单";break;case"/me":this.title="我",this.colorThree="color:#2196f3"}this.value=this.$router.currentRoute.path,0==this.unreadNumber?this.iconThree=":fa fa-user-circle-o":this.unreadNumber>9?(this.iconThree="filter_9_plus","/me"!=this.$router.currentRoute.path?this.colorThree="color:#ff4081":this.colorThree=""):(this.iconThree="filter_"+this.unreadNumber,"/me"!=this.$router.currentRoute.path?this.colorThree="color:#ff4081":this.colorThree="")}},computed:h()({},Object(i.b)(["appbarStyle","unreadNumber"])),watch:{$route:function(t){this.init()},unreadNumber:function(t){this.init()}},mounted:function(){this.init()}},f={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("mu-appbar",{class:"top-van "+t.appbarStyle,attrs:{title:t.title}},[t.lefticon?n("mu-button",{style:t.letfstyle,attrs:{slot:"left",icon:""},on:{click:t.leftevent},slot:"left"},[n("mu-icon",{attrs:{value:t.lefticon}})],1):t._e(),t._v(" "),t.righticon?n("mu-button",{style:t.rightstyle,attrs:{slot:"right",icon:"",flat:""},on:{click:t.rightevent},slot:"right"},[n("mu-icon",{attrs:{value:t.righticon,left:""}})],1):n("mu-button",{attrs:{slot:"right",icon:"",flat:""},slot:"right"},[n("i",{staticClass:"fa fa-github",staticStyle:{"font-size":"26px","margin-right":"8px"}})])],1),t._v(" "),n("mu-container",{staticStyle:{position:"absolute",top:"65px"}},[t._t("default"),t._v(" "),n("div",{staticStyle:{height:"70px"}})],2),t._v(" "),n("mu-bottom-nav",{staticClass:"bot-van",attrs:{value:t.value},on:{"update:value":function(e){t.value=e},change:t.goto}},[n("mu-bottom-nav-item",{staticClass:"bot-font-icon",attrs:{value:"/",icon:":fa fa-circle-o-notch"}}),t._v(" "),n("mu-bottom-nav-item",{staticClass:"bot-font-icon",attrs:{value:"/tally",icon:":fa fa-pie-chart"}}),t._v(" "),n("mu-bottom-nav-item",{staticClass:"bot-font-icon",style:t.colorThree,attrs:{value:"/me",icon:t.iconThree}})],1)],1)},staticRenderFns:[]};var g=n("VU/8")(d,f,!1,function(t){n("pePl")},null,null).exports,v=n("4qdD"),y=n.n(v),b={props:{user:{type:Object,required:!0}},data:function(){return{}},watch:{user:function(t){for(var e=[],n=parseInt((t.budget/50).toFixed(1)),a=0;a<=t.budget;a++)a%n==0&&e.push(a);e.push(t.budget);var i=y.a.Shape,o=[{pointer:"\n收入 "+this.$numberFormat(t.haveBeenIncome)+" 元\n\n预支 "+this.$numberFormat(t.haveBeenAdvance)+" 元",value:parseFloat(t.haveBeenUsed).toFixed(1),length:0,y:1}];i.registerShape("point","dashBoard",{getPoints:function(t){var e=t.x;return e>1&&(e=1),e<0&&(e=0),[{x:e,y:t.y},{x:e,y:.4}]},draw:function(t,e){var n=t.points[0],a=t.points[1];n=this.parsePoint(n),a=this.parsePoint(a);var i=e.addShape("Polyline",{attrs:{points:[n,a],stroke:"#d84315",lineWidth:2}}),o=t.origin._origin.value.toString();return[i,e.addShape("Text",{attrs:{text:o+" 元",x:t.center.x,y:t.center.y,fill:"#d84315",fontSize:22,textAlign:"center",textBaseline:"bottom"}}),e.addShape("Text",{attrs:{text:t.origin._origin.pointer,x:t.center.x,y:t.center.y,fillStyle:"#ccc",textAlign:"center",textBaseline:"top"}})]}});var s=new y.a.Chart({id:"mountNode",animate:!1,pixelRatio:window.devicePixelRatio});s.source(o,{value:{type:"linear",min:0,max:t.budget,ticks:e,nice:!1},length:{type:"linear",min:0,max:1},y:{type:"linear",min:0,max:1}}),s.coord("polar",{inner:0,startAngle:-1.25*Math.PI,endAngle:.25*Math.PI}),s.axis("value",{tickLine:{strokeStyle:"#ccc",lineWidth:3,length:-6},label:null,grid:null,line:null}),s.axis("y",!1);var r=t.haveBeenUsed-n/3;r=(r=r>5?t.haveBeenUsed-n/3:5)>t.budget-5?t.budget-5:r,t.haveBeenUsed>0&&s.guide().arc({start:[5,1.05],end:[r,1.05],style:{strokeStyle:"#d84315",lineWidth:4,lineCap:"round"}}),t.haveBeenUsed+n/3<t.budget-5&&s.guide().arc({start:[t.haveBeenUsed+n/3,1.05],end:[t.budget-6,1.05],style:{strokeStyle:"#1890FF",lineWidth:4,lineCap:"round"}}),s.guide().text({position:[t.budget,1.2],content:t.budget+"",style:{fillStyle:"#ccc",font:"18px Arial",textAlign:"center"}}),s.guide().text({position:[0,1.2],content:"0",style:{fillStyle:"#ccc",font:"18px Arial",textAlign:"center"}}),s.guide().text({position:[t.budget/2,1.16],content:t.budget/2+"",style:{fillStyle:"#ccc",font:"18px Arial",textAlign:"center"}}),s.point().position("value*y").size("length").color("#1890FF").shape("dashBoard"),s.render()}}},_={render:function(){var t=this.$createElement;return(this._self._c||t)("canvas",{staticStyle:{width:"100%"},attrs:{id:"mountNode",height:"246"}})},staticRenderFns:[]},x=n("VU/8")(b,_,!1,null,null,null).exports,w=n("Gu7T"),k=n.n(w),$={props:{title:{type:String},open:{type:Boolean},buttonclick:{type:Function},buttonicon:{type:String}},computed:h()({},Object(i.b)(["appbarStyle"]))},F={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("mu-dialog",{attrs:{fullscreen:"",open:t.open},on:{"update:open":function(e){t.open=e}}},[n("mu-appbar",{class:t.appbarStyle,attrs:{title:t.title}},[n("mu-button",{attrs:{slot:"left",icon:""},on:{click:function(e){t.$emit("update:open",!1)}},slot:"left"},[n("mu-icon",{attrs:{value:"close"}})],1),t._v(" "),t.buttonicon?n("mu-button",{attrs:{slot:"right",flat:""},on:{click:t.buttonclick},slot:"right"},[n("mu-icon",{attrs:{value:t.buttonicon}})],1):t._e()],1),t._v(" "),n("br"),t._v(" "),t._t("default")],2)},staticRenderFns:[]},S=n("VU/8")($,F,!1,null,null,null).exports,D={components:{dialoghead:S},props:{openTally:{type:Boolean,required:!0},consume:{type:String,required:!0},money:{type:String,required:!0}},data:function(){return{thatOpenTally:!1,thatStep:-1,tallyForm:{mode:"",channel:"",date:"",remark:""},manyType:{channels:[],modes:[{content:"收入"},{content:"支出"},{content:"预支"}],consumes:[]},buttonicon:""}},computed:h()({},Object(i.b)(["currentUser"])),methods:{submit:function(){var t=this,e=t.$loading({});t.$axios.post("/tally/add",{money:parseFloat(t.money),type:t.consume,mode:t.tallyForm.mode,channel:t.tallyForm.channel,remark:t.tallyForm.remark,ttime:new Date(t.tallyForm.date).toISOString()}).then(function(n){0==n.code&&(t.$toast.success("添加成功"),setTimeout(function(){t.$emit("update:openTally",!1),t.thatOpenTally=!1,t.$emit("update:consume",""),t.$emit("update:money","")},1200)),e.close()})}},watch:{currentUser:function(t){this.manyType.channels=[{content:"",default:[]}].concat(k()(t.channels)),this.manyType.consumes=this.$linq(t.consumes).select(function(t){return t.content}).toArray()},thatStep:function(t){var e=this;if(this.buttonicon=2==t?"done":"",0==t){var n=e.$linq(e.currentUser.consumes).firstOrDefault(function(t){return t.content==e.consume});n&&(e.manyType.modes=e.$linq(e.manyType.modes).select(function(t){return t.hide=n.default.indexOf(t.content)<0,t}).toArray());var a=e.$linq(e.manyType.modes).where(function(t){return!t.hide}).toArray();1==a.length&&(e.thatStep+=1,e.tallyForm.mode=a[0].content)}else if(1==t)"预支"!=this.tallyForm.mode&&(this.tallyForm.channel="余额",this.thatStep+=1),e.$linq(e.manyType.channels).select(function(t){return t.hide=t.default.indexOf(e.tallyForm.mode)<0,t}).toArray();else if(2==t){e.tallyForm.date=new Date;var i="收入"==e.tallyForm.mode?"收取":"支付";e.tallyForm.remark=""+e.consume+e.tallyForm.mode+"了"+e.money+"元，通过"+e.tallyForm.channel+i+"。"}},thatOpenTally:function(t){t?this.thatStep=0:(this.thatStep=-1,this.tallyForm={mode:"",channel:"",date:"",remark:""},this.$emit("update:openTally",!1))},openTally:function(t){t&&(this.thatOpenTally=!0)}}},M={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("dialoghead",{attrs:{title:t.consume+"："+t.money+" 元",open:t.thatOpenTally,buttonclick:t.submit,buttonicon:t.buttonicon},on:{"update:open":function(e){t.thatOpenTally=e}}},[n("mu-stepper",{attrs:{"active-step":t.thatStep,orientation:"vertical"}},[n("mu-step",[n("mu-step-label",[t._v("\n        收入/支出/预支\n        "),n("b",[t._v(t._s(t.tallyForm.mode.length>0?" ：":"")+t._s(t.tallyForm.mode))])]),t._v(" "),n("mu-step-content",[n("mu-list",t._l(t.manyType.modes,function(e,a){return e.content.length>0&&!e.hide?n("mu-list-item",{key:a},[n("mu-list-item-content",[n("mu-radio",{attrs:{label:e.content,value:e.content},on:{change:function(e){t.thatStep++}},model:{value:t.tallyForm.mode,callback:function(e){t.$set(t.tallyForm,"mode",e)},expression:"tallyForm.mode"}})],1)],1):t._e()}))],1)],1),t._v(" "),n("mu-step",[n("mu-step-label",[t._v("\n        方式\n        "),n("b",[t._v(t._s(t.tallyForm.channel.length>0?" ：":"")+t._s(t.tallyForm.channel))])]),t._v(" "),n("mu-step-content",[n("mu-list",t._l(t.manyType.channels,function(e,a){return e.content.length>0&&!e.hide?n("mu-list-item",{key:a},[n("mu-list-item-content",[n("mu-radio",{attrs:{label:e.content,value:e.content},on:{change:function(e){t.thatStep++}},model:{value:t.tallyForm.channel,callback:function(e){t.$set(t.tallyForm,"channel",e)},expression:"tallyForm.channel"}})],1)],1):t._e()})),t._v(" "),n("mu-button",{attrs:{flat:"",color:"primary"},on:{click:function(e){t.thatStep--}}},[t._v("上一步")])],1)],1),t._v(" "),n("mu-step",[n("mu-step-label",[t._v("\n        其他\n      ")]),t._v(" "),n("mu-step-content",[n("br"),t._v(" "),n("mu-form",{attrs:{model:t.tallyForm,"label-position":"top","label-width":"70"}},[n("mu-form-item",{attrs:{prop:"date",label:"日期"}},[n("mu-date-input",{staticStyle:{height:"30px"},attrs:{type:"dateTime",actions:""},model:{value:t.tallyForm.date,callback:function(e){t.$set(t.tallyForm,"date",e)},expression:"tallyForm.date"}})],1),t._v(" "),n("mu-form-item",{attrs:{prop:"input",label:"备注"}},[n("mu-text-field",{staticStyle:{height:"30px"},model:{value:t.tallyForm.remark,callback:function(e){t.$set(t.tallyForm,"remark",e)},expression:"tallyForm.remark"}})],1),t._v(" "),n("mu-form-item",[n("mu-button",{attrs:{flat:"",color:"primary"},on:{click:function(e){t.thatStep--}}},[t._v("上一步")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]},T={components:{layoutmain:g,residue:x,addtally:n("VU/8")(D,M,!1,null,null,null).exports},data:function(){return{tallyForm:{money:"",consume:""},consumes:[],openTally:!1,tallyList:[],titleWidth:.72*document.body.clientWidth}},methods:{showMode:function(){var t=this;if(!(this.tallyForm.money.length<=0||this.tallyForm.consume.length<=0)){var e=this;setTimeout(function(){e.openTally=!0},220);var n=!1;this.consumes.forEach(function(e){e==t.tallyForm.consume&&(n=!0)}),n||this.currentUser.consumes.push({content:this.tallyForm.consume,count:1,default:["收入","支出","预支"]})}},initLate:function(){var t=this,e=this.$linq(this.currentUser.consumes).select(function(t){return t.content}).toArray();t.$axios.post("/tally/get",{uids:[this.currentUser.id],btime:new Date((new Date).getFullYear(),(new Date).getMonth(),1).toISOString(),etime:new Date((new Date).getFullYear(),(new Date).getMonth()+1,1).toISOString(),bMoney:0,eMoney:999999,types:e,modes:[],channels:[],pageIndex:1,pageSize:3}).then(function(e){0==e.code&&null!=e.data&&(t.tallyList=e.data)})}},computed:h()({},Object(i.b)(["currentUser"])),watch:{currentUser:function(t){var e=this;this.consumes=[],t.consumes.forEach(function(t){e.consumes.push(t.content)}),this.initLate()},openTally:function(t){t||(this.tallyForm={money:"",consume:""},this.initLate(),this.$store.dispatch("initUser",{$router:this.$router}))}}},U={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("layoutmain",[n("mu-paper",{staticClass:"paper-title",style:"height:"+t.titleWidth+"px;",attrs:{"z-depth":0}},[n("residue",{attrs:{user:t.currentUser}})],1),t._v(" "),n("mu-paper",{staticStyle:{height:"100px",padding:"10px"},attrs:{"z-depth":1}},[n("mu-text-field",{staticStyle:{height:"80px",width:"50%"},attrs:{label:"金额",prefix:"￥",type:"number","label-float":""},on:{blur:t.showMode},model:{value:t.tallyForm.money,callback:function(e){t.$set(t.tallyForm,"money",e)},expression:"tallyForm.money"}}),t._v(" "),n("mu-auto-complete",{staticStyle:{height:"80px",width:"45%"},attrs:{data:t.consumes,label:"种类","max-search-results":5,"open-on-focus":"","label-float":""},on:{change:t.showMode},model:{value:t.tallyForm.consume,callback:function(e){t.$set(t.tallyForm,"consume",e)},expression:"tallyForm.consume"}})],1),t._v(" "),n("br"),t._v(" "),0!=t.tallyList.length?n("mu-list",[n("mu-sub-header",[t._v("\n      最近消费\n    ")]),t._v(" "),n("mu-divider"),t._v(" "),t._l(t.tallyList,function(e,a){return n("mu-list-item",{key:a,attrs:{avatar:"",ripple:!1}},[n("mu-list-item-action",[n("mu-avatar",[n("img",{attrs:{src:e.headImg}})])],1),t._v(" "),n("mu-list-item-content",[n("mu-list-item-title",[t._v(t._s(e.remark))]),t._v(" "),n("mu-list-item-sub-title",[t._v(t._s(t.$format(e.ttime,"yyyy-MM-dd hh:mm")))])],1)],1)})],2):t._e(),t._v(" "),n("mu-list",[n("mu-sub-header",[t._v("\n      快速记录\n    ")]),t._v(" "),n("mu-divider"),t._v(" "),n("mu-list-item",{attrs:{avatar:"",button:"",ripple:!0}},[n("mu-list-item-action",{staticStyle:{"text-align":"right"}},[t._v("\n        15 元\n        "),n("br"),t._v(" 微信支出\n      ")]),t._v(" "),n("mu-list-item-title",{staticStyle:{"text-align":"center"}},[t._v("午餐")]),t._v(" "),n("mu-list-item-action",[n("mu-button",{attrs:{icon:"",color:"#4caf50"}},[n("mu-icon",{attrs:{value:"fast_forward"}})],1)],1)],1)],1),t._v(" "),n("addtally",{attrs:{openTally:t.openTally,money:t.tallyForm.money,consume:t.tallyForm.consume},on:{"update:openTally":function(e){t.openTally=e}}})],1)},staticRenderFns:[]};var C=n("VU/8")(T,U,!1,function(t){n("7/3/")},"data-v-489b0e89",null).exports,A={props:{alert:{type:Boolean,required:!0},user:{type:Object,required:!0},type:{type:String,required:!0}},data:function(){return{thenAlert:this.alert,title:"",value:"",oldValue:"",prefix:"",textType:"number",textError:""}},methods:{submitBase:function(){var t=this,e=this,n=e.$loading(),a={headImg:e.user.headImg,nick:e.user.nick,budget:parseFloat(e.user.budget),fixDate:parseFloat(e.user.fixDate),wechatPay:parseFloat(e.user.wechatPay),aliPay:parseFloat(e.user.aliPay),backCard:parseFloat(e.user.backCard),cash:parseFloat(e.user.cash)};switch(this.type){case"nick":a.nick=e.value;break;case"budget":a.budget=parseFloat(e.value);break;case"backCard":a.backCard=parseFloat(e.value);break;case"aliPay":a.aliPay=parseFloat(e.value);break;case"wechatPay":a.wechatPay=parseFloat(e.value);break;case"fixDate":a.fixDate=parseFloat(e.value)}e.$axios.post("/user/set",a).then(function(a){0==a.code&&(e.$store.dispatch("initUser",{$router:t.$router}),e.thenAlert=!1),n.close()}).catch(function(){n.close()})},switchType:function(){switch(this.type){case"nick":this.title="修改昵称",this.oldValue=this.user.nick+"",this.prefix="昵称: ",this.textType="string";break;case"budget":this.title="修改预算",this.oldValue=this.user.budget+"",this.prefix="预算: ";break;case"backCard":this.title="修改银行卡余额",this.oldValue=this.user.backCard+"",this.prefix="银行卡余额: ";break;case"aliPay":this.title="修改支付宝余额",this.oldValue=this.user.aliPay+"",this.prefix="支付宝余额: ";break;case"wechatPay":this.title="修改微信余额",this.oldValue=this.user.wechatPay+"",this.prefix="微信余额: ";break;case"fixDate":this.title="修改定期余额",this.oldValue=this.user.fixDate+"",this.prefix="定期余额: "}}},watch:{thenAlert:function(t){t||this.$emit("update:alert",t)},alert:function(t){t&&(this.switchType(),this.thenAlert=t,this.value="")}}},O={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("mu-dialog",{attrs:{title:t.title,width:"600","max-width":"80%","esc-press-close":!1,"overlay-close":!1,open:t.thenAlert},on:{"update:open":function(e){t.thenAlert=e}}},[n("mu-text-field",{attrs:{type:t.textType,label:t.oldValue,prefix:t.prefix,"error-text":t.textError,"label-float":""},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),t._v(" "),n("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:function(e){t.thenAlert=!1}},slot:"actions"},[t._v("取消")]),t._v(" "),n("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:t.submitBase},slot:"actions"},[t._v("保存")])],1)},staticRenderFns:[]};var I=n("VU/8")(A,O,!1,function(t){n("Qg0Z")},null,null).exports,E={props:{open:{type:Boolean},item:{type:Object}},components:{dialoghead:S},data:function(){return{thatOpen:!1,name:"",dateSlots:[{width:"100%",textAlign:"right",values:["当月","次月"]},{width:"100%",textAlign:"left",values:function(){for(var t=[],e=1;e<=31;e++)t.push(e+"日");return t.push("月底"),t}()}]}},methods:{changerdate:function(t,e){this.item.rdate[e]=t,0==e?this.item.rdate=[t,"1日"]:1==e&&(this.item.rdate=[this.item.rdate[0],t])},submit:function(){var t=this,e=this.$loading({});this.item.isAdvance=!0,this.item.default=["预支"];var n="";n=this.item.id?"/channel/set":"/channel/add",this.$axios.post(n,this.item).then(function(n){0==n.code&&setTimeout(function(){t.thatOpen=!1},500),e.close()})}},watch:{open:function(t){t&&(this.thatOpen=!0)},thatOpen:function(t){t||this.$emit("update:open",!1)},item:function(t){t.rdate||(t.rdate=["当月","1日"])}}},R={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("dialoghead",{attrs:{title:"预支设置",open:t.thatOpen,buttonclick:t.submit,buttonicon:"done"},on:{"update:open":function(e){t.thatOpen=e}}},[n("mu-container",[n("mu-text-field",{attrs:{label:"名称","full-width":"",placeholder:"如:xxx信用卡",disabled:!!t.item.id},model:{value:t.item.content,callback:function(e){t.$set(t.item,"content",e)},expression:"item.content"}})],1),t._v(" "),n("mu-sub-header",[t._v("还款日期")]),t._v(" "),n("div",{staticStyle:{}},[n("mu-slide-picker",{attrs:{slots:t.dateSlots,"visible-item-count":5,values:t.item.rdate},on:{change:t.changerdate}})],1)],1)},staticRenderFns:[]};var q=n("VU/8")(E,R,!1,function(t){n("loy4")},null,null).exports,B={components:{setuserbaseinfo:I,layoutmain:g,vuecoreimageupload:n("ngqk").default,setadvance:q},data:function(){return{open:"",openSetAdvance:!1,currentAdvance:{},baseInfo:{alert:!1,type:""},addpartnerOpen:!1,openMessage:!1,uploadUrl:this.$fileUrl,uploadData:{id:"",fileName:"head-image-"+(new Date).getMilliseconds()},advance:[]}},computed:h()({},Object(i.b)(["currentUser","unreadNumber"])),methods:{loginOut:function(){var t=this;t.$axios.get("/land/signout/"+localStorage.getItem("token")).then(function(){localStorage.clear(),alert("已退出登陆"),t.$router.push({path:"/sign"})})},openBaseInfoSet:function(t){this.baseInfo={alert:!0,type:t}},openUpload:function(){document.getElementsByName("files")[0].click()},uploaded:function(t){if(t.result){this.currentUser.headImg=t.path;var e=this;e.$axios.post("/user/set",{headImg:this.currentUser.headImg,nick:this.currentUser.nick,budget:parseFloat(this.currentUser.budget),fixDate:parseFloat(this.currentUser.fixDate),wechatPay:parseFloat(this.currentUser.wechatPay),aliPay:parseFloat(this.currentUser.aliPay),backCard:parseFloat(this.currentUser.backCard),cash:parseFloat(this.currentUser.cash),utime:this.currentUser.utime}).then(function(t){0==t.code&&e.$toast.success("设置成功")})}},getAdvance:function(){var t=this,e=new Date;this.$axios.post("/tally/getadvance",{btime:new Date(e.getFullYear(),e.getMonth(),1).toISOString(),etime:new Date(e.getFullYear(),e.getMonth()+1,1).toISOString()}).then(function(e){0==e.code&&e.data&&(t.advance=e.data)})}},watch:{currentUser:function(t){this.uploadData.id=this.currentUser.id}},mounted:function(){this.getAdvance()}},L={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("layoutmain",[n("mu-paper",{staticStyle:{height:"110px",padding:"10px"},attrs:{"z-depth":2}},[n("mu-list",{attrs:{textline:"three-line"}},[n("mu-list-item",{attrs:{avatar:"",button:"",ripple:!1}},[n("mu-list-item-action",[n("mu-avatar",{staticStyle:{width:"70px",height:"70px"}},[n("img",{attrs:{src:t.currentUser.headImg}})])],1),t._v(" "),n("mu-list-item-content",{staticStyle:{"margin-left":"22px","margin-top":"-17px"}},[n("mu-list-item-title",[t._v(t._s(t.currentUser.nick))]),t._v(" "),n("mu-list-item-sub-title",[t._v("\n            账号 : "+t._s(t.currentUser.name)+"\n          ")]),t._v(" "),n("mu-list-item-sub-title",[t._v("\n            备注 : "+t._s(t.currentUser.intro)+"\n          ")])],1),t._v(" "),n("mu-list-item-action",[t.unreadNumber>0?n("mu-badge",{attrs:{content:t.unreadNumber+"",circle:"",color:"secondary"}},[n("mu-button",{attrs:{icon:"",color:"blue"},on:{click:function(e){t.$router.push({path:"message"})}}},[n("mu-icon",{attrs:{value:"notifications"}})],1)],1):n("mu-button",{attrs:{icon:""},on:{click:function(e){t.$router.push({path:"message"})}}},[n("mu-icon",{attrs:{value:"notifications"}})],1)],1)],1)],1)],1),t._v(" "),n("br"),t._v(" "),n("mu-list",{attrs:{"toggle-nested":""}},[n("mu-sub-header",[t._v("个人设置")]),t._v(" "),n("mu-divider"),t._v(" "),n("mu-list-item",{attrs:{button:"",ripple:!1,nested:"",open:"base"===t.open},on:{"toggle-nested":function(e){t.open=arguments[0]?"base":""}}},[n("mu-list-item-title",[t._v("基本信息")]),t._v(" "),n("mu-list-item-action",["base"===t.open?n("mu-icon",{staticClass:"toggle-icon",attrs:{size:"24",value:"keyboard_arrow_up"}}):n("mu-icon",{staticClass:"toggle-icon",attrs:{size:"24",value:"keyboard_arrow_down"}})],1),t._v(" "),n("mu-list-item",{attrs:{slot:"nested",button:"",ripple:!0},on:{click:function(e){t.openUpload()}},slot:"nested"},[n("mu-list-item-title",[t._v("头像")]),t._v(" "),n("mu-list-item-action",[n("mu-icon",{attrs:{value:"cloud_upload",color:"Teal"}})],1)],1),t._v(" "),n("mu-list-item",{attrs:{slot:"nested",button:"",ripple:!0},on:{click:function(e){t.openBaseInfoSet("nick")}},slot:"nested"},[n("mu-list-item-title",[t._v("昵称")]),t._v(" "),n("mu-list-item-action",[n("mu-icon",{attrs:{value:"edit",color:"Teal"}})],1)],1),t._v(" "),n("mu-list-item",{attrs:{slot:"nested",button:"",ripple:!0},slot:"nested"},[n("mu-list-item-title",[t._v("密码")]),t._v(" "),n("mu-list-item-action",[n("mu-icon",{attrs:{value:"edit",color:"Teal"}})],1)],1),t._v(" "),n("mu-list-item",{attrs:{slot:"nested",button:"",ripple:!0},on:{click:function(e){t.openBaseInfoSet("budget")}},slot:"nested"},[n("mu-list-item-title",[t._v("\n          每月预算\n        ")]),t._v(" "),n("mu-list-item-action",[n("span",{staticClass:"span-money"},[t._v(t._s(t.$numberFormat(t.currentUser.budget)))])])],1)],1),t._v(" "),n("mu-list-item",{attrs:{button:"",ripple:!1,nested:"",open:"partner"===t.open},on:{"toggle-nested":function(e){t.open=arguments[0]?"partner":""}}},[n("mu-list-item-title",[t._v("小伙伴")]),t._v(" "),n("mu-list-item-action",["partner"===t.open?n("mu-icon",{staticClass:"toggle-icon",attrs:{size:"24",value:"keyboard_arrow_up"}}):n("mu-icon",{staticClass:"toggle-icon",attrs:{size:"24",value:"keyboard_arrow_down"}})],1),t._v(" "),t._l(t.currentUser.partners,function(e){return n("mu-list-item",{key:e.id,attrs:{slot:"nested",button:"",ripple:!0},slot:"nested"},[n("mu-list-item-action",[n("mu-avatar",[n("img",{attrs:{src:e.headImg}})])],1),t._v(" "),n("mu-list-item-title",[t._v(t._s(e.nick))]),t._v(" "),n("mu-list-item-action",[n("mu-icon",{attrs:{value:"chat_bubble"}})],1)],1)}),t._v(" "),n("mu-list-item",{attrs:{slot:"nested",button:"",ripple:!0},on:{click:function(e){t.$router.push({path:"addpartner"})}},slot:"nested"},[n("mu-list-item-title",[t._v("添加更多")]),t._v(" "),n("mu-list-item-action",[n("mu-button",{attrs:{icon:"",color:"#f44336"}},[n("mu-icon",{attrs:{value:"zoom_in"}})],1)],1)],1)],2)],1),t._v(" "),n("mu-list",{attrs:{"toggle-nested":""}},[n("mu-sub-header",[t._v("钱钱钱")]),t._v(" "),n("mu-divider"),t._v(" "),n("mu-list-item",{attrs:{button:"",ripple:!1,nested:"",open:"advance"===t.open},on:{"toggle-nested":function(e){t.open=arguments[0]?"advance":""}}},[n("mu-list-item-title",[t._v("预支")]),t._v(" "),n("mu-list-item-action",["advance"===t.open?n("mu-icon",{staticClass:"toggle-icon",attrs:{size:"24",value:"keyboard_arrow_up"}}):n("mu-icon",{staticClass:"toggle-icon",attrs:{size:"24",value:"keyboard_arrow_down"}})],1),t._v(" "),t._l(t.advance,function(e){return n("mu-list-item",{key:e._id,attrs:{slot:"nested",button:"",ripple:!0},on:{click:function(n){t.openSetAdvance=!0,t.currentAdvance=e.base}},slot:"nested"},[n("mu-list-item-title",[t._v("\n          "+t._s(e._id)+"\n          "),e.base.rdate?n("span",{staticClass:"span-content"},[t._v("\n            "+t._s(e.base.rdate[0])+t._s(e.base.rdate[1])+"还款\n          ")]):t._e()]),t._v(" "),n("mu-list-item-action",[n("span",{staticClass:"span-money loan"},[t._v(t._s(t.$numberFormat(e.money)))])])],1)}),t._v(" "),n("mu-list-item",{attrs:{slot:"nested",button:"",ripple:!0},on:{click:function(e){t.openSetAdvance=!0,t.currentAdvance={}}},slot:"nested"},[n("mu-list-item-title",[t._v("添加更多")]),t._v(" "),n("mu-list-item-action",[n("mu-icon",{attrs:{value:"add",color:"Red"}})],1)],1)],2),t._v(" "),n("mu-list-item",{attrs:{button:"",ripple:!1,nested:"",open:"loan"===t.open},on:{"toggle-nested":function(e){t.open=arguments[0]?"loan":""}}},[n("mu-list-item-title",[t._v("定时账单")]),t._v(" "),n("mu-list-item-action",["loan"===t.open?n("mu-icon",{staticClass:"toggle-icon",attrs:{size:"24",value:"keyboard_arrow_up"}}):n("mu-icon",{staticClass:"toggle-icon",attrs:{size:"24",value:"keyboard_arrow_down"}})],1),t._v(" "),n("mu-list-item",{attrs:{slot:"nested",button:"",ripple:!0},slot:"nested"},[n("mu-list-item-title",[t._v("\n          房贷\n          "),n("span",{staticClass:"span-content"},[t._v("\n            每月12日\n          ")])]),t._v(" "),n("mu-list-item-action",[n("span",{staticClass:"span-money loan"},[t._v(t._s(t.$numberFormat(2987)))])])],1),t._v(" "),n("mu-list-item",{attrs:{slot:"nested",button:"",ripple:!0},slot:"nested"},[n("mu-list-item-title",[t._v("\n          信用卡分期\n          "),n("span",{staticClass:"span-content"},[t._v("\n            每月20日\n          ")])]),t._v(" "),n("mu-list-item-action",[n("span",{staticClass:"span-money loan"},[t._v(t._s(t.$numberFormat(2987)))])])],1),t._v(" "),n("mu-list-item",{attrs:{slot:"nested",button:"",ripple:!0},slot:"nested"},[n("mu-list-item-title",[t._v("添加更多")]),t._v(" "),n("mu-list-item-action",[n("mu-icon",{attrs:{value:"add",color:"Red"}})],1)],1)],1)],1),t._v(" "),n("mu-list",[n("mu-sub-header",[t._v("其他")]),t._v(" "),n("mu-divider"),t._v(" "),n("mu-list-item",{attrs:{button:""}},[n("mu-list-item-title",[t._v("快速消费类型")]),t._v(" "),n("mu-list-item-action",[n("mu-icon",{attrs:{value:"navigate_next"}})],1)],1),t._v(" "),n("mu-list-item",{attrs:{button:""}},[n("mu-list-item-title",[t._v("账单类型")]),t._v(" "),n("mu-list-item-action",[n("mu-icon",{attrs:{value:"navigate_next"}})],1)],1)],1),t._v(" "),n("br"),t._v(" "),n("vuecoreimageupload",{attrs:{data:t.uploadData,crop:"local",url:t.uploadUrl,"crop-ratio":"1:1",extensions:"png,jpeg,jpg",compress:"60",text:""},on:{imageuploaded:t.uploaded}}),t._v(" "),n("mu-flex",{attrs:{"justify-content":"center","align-items":"center"}},[n("mu-button",{attrs:{round:"",color:"success","full-width":""},on:{click:t.loginOut}},[t._v("退出登陆")])],1),t._v(" "),n("setuserbaseinfo",{attrs:{user:t.currentUser,type:t.baseInfo.type,alert:t.baseInfo.alert},on:{"update:alert":function(e){t.$set(t.baseInfo,"alert",e)}}}),t._v(" "),n("setadvance",{attrs:{open:t.openSetAdvance,item:t.currentAdvance},on:{"update:open":function(e){t.openSetAdvance=e}}})],1)},staticRenderFns:[]};var j=n("VU/8")(B,L,!1,function(t){n("6fDL")},null,null).exports,P=n("mvHQ"),V=n.n(P),N={props:{open:{type:Boolean},currentItem:{type:Object}},components:{dialoghead:S},data:function(){return{thatOpen:!1,consumes:[],labelPosition:"top",form:{id:0,money:0,type:"",mode:"",channel:"",ctime:"",remark:""},thatSetInterval:0,openAlert:!1}},methods:{submit:function(){var t=this,e=t.$loading({});t.form.money=parseFloat(t.form.money),t.$axios.post("/tally/set",t.form).then(function(n){0==n.code&&(t.currentItem.money=t.form.money,t.currentItem.type=t.form.type,t.currentItem.mode=t.form.mode,t.currentItem.ttime=t.form.ttime,t.currentItem.remark=t.form.remark,setTimeout(function(){0!=t.thatSetInterval&&clearInterval(t.thatSetInterval),t.form={id:0,money:0,type:"",mode:"",channel:"",ctime:"",remark:""},t.thatOpen=!1},800)),e.close()})},del:function(){var t=this,e=t.$loading({});t.$axios.get("/tally/delete/"+t.form.id).then(function(n){0==n.code&&(t.openAlert=!1,t.currentItem.tid="",setTimeout(function(){t.thatOpen=!1},300)),e.close()}).catch(function(){e.close()})}},watch:{currentUser:function(t){t&&(this.consumes=this.$linq(t.consumes).select(function(t){return t.content}).toArray())},open:function(t){t&&(this.thatOpen=!0)},thatOpen:function(t){t||(this.$emit("update:currentItem",{}),this.$emit("update:open",!1))},currentItem:function(t){t.money&&(this.form={id:t.tid,money:t.money,type:t.type,mode:t.mode,channel:t.channel,ttime:t.ttime,remark:t.remark})},form:function(t){if(t.money){var e="收入"==t.mode?"收取":"支付";""+t.type+t.mode+"了"+t.money+"元，通过"+t.channel+e+"。"==t.remark&&(this.thatSetInterval=setInterval(function(){var e="收入"==t.mode?"收取":"支付";t.remark=""+t.type+t.mode+"了"+t.money+"元，通过"+t.channel+e+"。"},800))}}},computed:h()({},Object(i.b)(["currentUser"]))},z={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("dialoghead",{attrs:{title:"修改账单",open:t.thatOpen,buttonclick:t.submit,buttonicon:"done"},on:{"update:open":function(e){t.thatOpen=e}}},[n("mu-form",{attrs:{model:t.form,"label-position":"right","label-width":"68"}},[n("mu-form-item",{attrs:{prop:"input",label:"金额"}},[n("mu-text-field",{attrs:{type:"number"},model:{value:t.form.money,callback:function(e){t.$set(t.form,"money",e)},expression:"form.money"}})],1),t._v(" "),n("mu-form-item",{attrs:{prop:"select",label:"种类"}},[n("mu-auto-complete",{attrs:{data:t.consumes,"max-search-results":8,"open-on-focus":"","label-float":""},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}})],1),t._v(" "),n("mu-form-item",{attrs:{prop:"date",label:"模式"}},[n("mu-radio",{attrs:{value:"收入",label:"收入"},model:{value:t.form.mode,callback:function(e){t.$set(t.form,"mode",e)},expression:"form.mode"}}),t._v(" "),n("mu-radio",{attrs:{value:"支出",label:"支出"},model:{value:t.form.mode,callback:function(e){t.$set(t.form,"mode",e)},expression:"form.mode"}}),t._v(" "),n("mu-radio",{attrs:{value:"预支",label:"预支"},model:{value:t.form.mode,callback:function(e){t.$set(t.form,"mode",e)},expression:"form.mode"}})],1),t._v(" "),n("mu-form-item",{attrs:{prop:"radio",label:"方式"}},t._l(t.currentUser.channels,function(e){return n("mu-radio",{key:e.content,attrs:{value:e.content,label:e.content},model:{value:t.form.channel,callback:function(e){t.$set(t.form,"channel",e)},expression:"form.channel"}})})),t._v(" "),n("mu-form-item",{attrs:{prop:"checkbox",label:"日期"}},[n("mu-date-input",{attrs:{type:"dateTime",actions:""},model:{value:t.form.ttime,callback:function(e){t.$set(t.form,"ttime",e)},expression:"form.ttime"}})],1),t._v(" "),n("mu-form-item",{attrs:{prop:"switch",label:"备注"}},[n("mu-text-field",{model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),t._v(" "),n("div",{staticStyle:{"text-align":"right","margin-right":"10px","margin-top":"10px"}},[n("mu-button",{attrs:{color:"red"},on:{click:function(e){t.openAlert=!0}}},[t._v("\n      删除当前账单\n      "),n("mu-icon",{attrs:{right:"",value:"delete"}})],1)],1),t._v(" "),n("mu-dialog",{attrs:{title:"确认操作 ?",width:"600","max-width":"80%","esc-press-close":!1,"overlay-close":!1,open:t.openAlert},on:{"update:open":function(e){t.openAlert=e}}},[t._v("\n    是否确定删除当前订单,删除后不可恢复!\n    "),n("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:function(e){t.openAlert=!1}},slot:"actions"},[t._v("取消")]),t._v(" "),n("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:function(e){t.del()}},slot:"actions"},[t._v("删除")])],1)],1)},staticRenderFns:[]};var H=n("VU/8")(N,z,!1,function(t){n("QGfW")},null,null).exports,W={props:{open:{type:Boolean,default:!1}}},Y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("mu-drawer",{staticStyle:{top:"55px","border-radius":"0px"},attrs:{open:t.open,letf:"",docked:!0,"z-depth":0},on:{"update:open":function(e){t.open=e}}},[n("mu-list",[n("mu-list-item",{attrs:{button:""}},[n("mu-list-item-action",[n("i",{staticClass:"fa fa-pie-chart",staticStyle:{"font-size":"20px"}})]),t._v(" "),n("mu-list-item-title",[t._v("资产配置")])],1),t._v(" "),n("mu-list-item",{attrs:{button:""}},[n("mu-list-item-action",[n("i",{staticClass:"fa fa-bar-chart",staticStyle:{"font-size":"20px"}})]),t._v(" "),n("mu-list-item-title",[t._v("柱状图统计")])],1),t._v(" "),n("mu-list-item",{attrs:{button:""}},[n("mu-list-item-action",[n("i",{staticClass:"fa fa-area-chart",staticStyle:{"font-size":"20px"}})]),t._v(" "),n("mu-list-item-title",[t._v("消费折线图")])],1),t._v(" "),n("mu-list-item",{attrs:{button:""}},[n("mu-list-item-action",[n("i",{staticClass:"fa fa-location-arrow",staticStyle:{"font-size":"20px"}})]),t._v(" "),n("mu-list-item-title",[t._v("费用去向")])],1)],1)],1)},staticRenderFns:[]};var X=n("VU/8")(W,Y,!1,function(t){n("cAxO")},null,null).exports,G={props:{open:{type:Boolean,default:!1},searchForm:{type:Object,default:!1}},data:function(){return{total:"0",copyConsumes:[],thatOpen:!1}},methods:{getTotal:function(){var t=this,e=this.$linq(this.copyConsumes).where(function(t){return t.selected}).select(function(t){return t.content}).toArray();this.$axios.post("/tally/total",{uids:this.searchForm.partners,btime:new Date(new Date(this.searchForm.ttime).getFullYear(),new Date(this.searchForm.ttime).getMonth(),1).toISOString(),etime:new Date(new Date(this.searchForm.ttime).getFullYear(),new Date(this.searchForm.ttime).getMonth()+1,1).toISOString(),bMoney:0,eMoney:999999,types:e,modes:this.searchForm.modes}).then(function(e){0==e.code&&(t.total=parseFloat(e.data).toFixed(1))})},search:function(){this.thatOpen=!1},randomColor:function(){return"#5c6bc0"},selected:function(t){t.selected=!t.selected,this.getTotal(),this.copyConsumes=this.$linq(this.copyConsumes).orderByDescending(function(t){return t.selected}).thenByDescending(function(t){return t.count}).thenByDescending(function(t){return new Date(t.utime)}).thenByDescending(function(t){return new Date(t.ctime)}).toArray()},clearSearch:function(){this.copyConsumes.forEach(function(t){return t.selected=!1}),this.total=0},getTypes:function(){var t=this;this.$axios.post("/tally/gettypes",{modes:this.searchForm.modes,uids:this.searchForm.partners,btime:new Date(new Date(this.searchForm.ttime).getFullYear(),new Date(this.searchForm.ttime).getMonth(),1).toISOString(),etime:new Date(new Date(this.searchForm.ttime).getFullYear(),new Date(this.searchForm.ttime).getMonth()+1,1).toISOString()}).then(function(e){0==e.code&&(t.copyConsumes=t.$linq(e.data).select(function(e){return{color:t.randomColor(),selected:!0,content:e._id,count:e.count,ctime:e.ctime,ttime:e.ttime}}).orderByDescending(function(t){return t.selected}).thenByDescending(function(t){return t.count}).thenByDescending(function(t){return new Date(t.utime)}).thenByDescending(function(t){return new Date(t.ctime)}).toArray())})}},watch:{open:function(t){t&&(this.thatOpen=!0)},thatOpen:function(t){t||(this.searchForm.consumes=this.copyConsumes,this.$emit("update:open",!1))},currentUser:function(t){t&&this.getTypes()},"searchForm.partners.length":function(){this.getTotal(),this.getTypes()},"searchForm.modes.length":function(){this.getTotal(),this.getTypes()},"searchForm.ttime":function(){this.getTotal(),this.getTypes()}},computed:h()({},Object(i.b)(["currentUser"]))},K={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("mu-drawer",{staticStyle:{top:"55px","border-radius":"0px",padding:"15px 15px"},attrs:{open:t.thatOpen,right:"",docked:!1,"z-depth":0,width:"80%"},on:{"update:open":function(e){t.thatOpen=e}}},[n("mu-list",[n("mu-list-item",[n("mu-list-item-action",[n("mu-avatar",[t._v("\n          总\n        ")])],1),t._v(" "),n("mu-list-item-title",[t._v("\n        "+t._s(t.$numberFormat(t.total))+" 元\n      ")])],1)],1),t._v(" "),n("mu-divider"),t._v(" "),n("mu-form",{staticStyle:{"margin-top":"20px"},attrs:{model:t.searchForm,"label-position":"top"}},[n("mu-form-item",{attrs:{prop:"partners",label:"小伙伴"}},[n("mu-checkbox",{attrs:{value:t.currentUser.id,label:"我"},model:{value:t.searchForm.partners,callback:function(e){t.$set(t.searchForm,"partners",e)},expression:"searchForm.partners"}}),t._v(" "),t._l(t.currentUser.partners,function(e){return[n("mu-checkbox",{attrs:{value:e.id,label:e.nick},model:{value:t.searchForm.partners,callback:function(e){t.$set(t.searchForm,"partners",e)},expression:"searchForm.partners"}})]})],2),t._v(" "),n("mu-form-item",{attrs:{prop:"modes",label:"方式"}},[n("mu-checkbox",{attrs:{value:"收入",label:"收入"},model:{value:t.searchForm.modes,callback:function(e){t.$set(t.searchForm,"modes",e)},expression:"searchForm.modes"}}),t._v(" "),n("mu-checkbox",{attrs:{value:"支出",label:"支出"},model:{value:t.searchForm.modes,callback:function(e){t.$set(t.searchForm,"modes",e)},expression:"searchForm.modes"}}),t._v(" "),n("mu-checkbox",{attrs:{value:"预支",label:"预支"},model:{value:t.searchForm.modes,callback:function(e){t.$set(t.searchForm,"modes",e)},expression:"searchForm.modes"}})],1),t._v(" "),n("mu-form-item",{attrs:{prop:"ttime",icon:"date_range"}},[n("mu-date-input",{attrs:{type:"month"},model:{value:t.searchForm.ttime,callback:function(e){t.$set(t.searchForm,"ttime",e)},expression:"searchForm.ttime"}})],1),t._v(" "),n("mu-form-item",{attrs:{prop:"consumes",label:"类型"}},[t._l(t.copyConsumes,function(e){return[n("mu-chip",{staticStyle:{"margin-top":"5px","margin-right":"5px"},attrs:{color:e.selected?e.color:"#424242"},on:{click:function(n){t.selected(e)}}},[n("mu-avatar",{attrs:{color:e.selected?e.color:"#424242",size:23}},[t._v(t._s(e.count))]),t._v(t._s(e.content)+"\n        ")],1)]})],2)],1),t._v(" "),n("div",{staticStyle:{"text-align":"right"}},[n("mu-button",{on:{click:function(e){t.clearSearch()}}},[t._v("\n      清空\n      "),n("mu-icon",{attrs:{right:"",value:"restore"}})],1),t._v(" "),n("mu-button",{attrs:{color:"primary"},on:{click:function(e){t.search()}}},[t._v("\n      查询\n      "),n("mu-icon",{attrs:{right:"",value:"search"}})],1)],1)],1)},staticRenderFns:[]};var Q={components:{layoutmain:g,settally:H,tallydrawer:X,tallysetdrawer:n("VU/8")(G,K,!1,function(t){n("V+li")},null,null).exports},data:function(){return{openDrawer:!1,openSetDrawer:!1,group:[],loading:!1,pageIndex:1,notNextList:!1,openSetTally:!1,currentTally:{},searchForm:{partners:[],channels:[],types:[],modes:["收入","支出","预支"],ttime:new Date}}},methods:{load:function(){this.notNextList||(console.log("下拉刷新"),this.getList(this.pageIndex))},getList:function(t){var e=this;e.loading=!0;var n=[];n=this.searchForm.consumes?this.$linq(this.searchForm.consumes).where(function(t){return t.selected}).select(function(t){return t.content}).toArray():this.$linq(this.currentUser.consumes).select(function(t){return t.content}).toArray();var a=new Date(this.searchForm.ttime);e.$axios.post("/tally/get",{uids:this.searchForm.partners,btime:new Date(a.getFullYear(),a.getMonth(),1).toISOString(),etime:new Date(a.getFullYear(),a.getMonth()+1,1).toISOString(),bMoney:0,eMoney:999999,types:n,modes:this.searchForm.modes,pageIndex:e.pageIndex,pageSize:12}).then(function(t){if(0==t.code){if(null!=t.data){e.pageIndex++;var n,a,i=e.$linq(t.data).groupBy("r=>(r.ttime+'').substring(0,10)").select("{key:$.key(),value:$.toArray()}").toArray();if(e.group.length>0&&i.length>0)if(e.group[e.group.length-1].key==i[0].key)(n=e.group[e.group.length-1].value).push.apply(n,k()(i[0].value)),i=i.slice(1);if(i.length>0)(a=e.group).push.apply(a,k()(i));t.data.length<10&&(e.notNextList=!0)}else e.notNextList=!0;e.loading=!1}})},getUserHeadImg:function(t){if(!this.currentUser)return"";if(!this.currentUser.partners)return"";for(var e=0;e<this.currentUser.partners.length;e++)if(this.currentUser.partners[e].id==t)return this.currentUser.partners[e].headImg;return this.currentUser.headImg},removeItem:function(t){console.log(t)}},computed:h()({},Object(i.b)(["currentUser"])),watch:{openDrawer:function(t){t&&(this.openSetDrawer=!t)},openSetDrawer:function(t){t?this.openDrawer=!t:(this.group=[],this.pageIndex=1,this.notNextList=!1,this.getList(this.pageIndex))},currentUser:function(t){this.getList(this.pageIndex);var e=this;e.searchForm.partners.push(t.id),null!=t.partners&&t.partners&&t.partners.forEach(function(t){e.searchForm.partners.push(t.id)}),this.searchForm.consumes=JSON.parse(V()(t.consumes)),this.searchForm.consumes.forEach(function(t){return t.selected=!0})}}},Z={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("layoutmain",{attrs:{lefticon:"toc",leftevent:function(){return t.openDrawer=!t.openDrawer},letfstyle:t.openDrawer?"":"transform:rotate(180deg);",righticon:"settings",rightevent:function(){return t.openSetDrawer=!t.openSetDrawer},rightstyle:t.openSetDrawer?"":"transform:rotate(360deg);"}},[n("mu-container",{ref:"container"},[n("mu-load-more",{attrs:{loading:t.loading},on:{load:t.load}},[t._l(t.group,function(e){return[n("mu-list",{attrs:{textline:"two-line"}},[n("mu-sub-header",[t._v(t._s(e.key))]),t._v(" "),t._l(e.value,function(e,a){return e.tid?n("mu-list-item",{key:a,attrs:{avatar:"",ripple:!1}},[n("mu-list-item-action",[n("mu-avatar",[n("img",{attrs:{src:e.headImg}})])],1),t._v(" "),n("mu-list-item-content",[n("mu-list-item-title",[t._v(t._s(e.money)+"元\n                "),n("span",{staticClass:"mu-item-sub-title"},[t._v(" - "+t._s(e.type))])]),t._v(" "),n("mu-list-item-sub-title",[n("span",{staticStyle:{color:"black"}},[t._v(t._s(e.channel))]),t._v("\n                 - "+t._s(e.mode)+"\n              ")])],1),t._v(" "),n("mu-list-item-action",[n("mu-list-item-after-text",[t._v(t._s(t.$format(e.ttime,"hh:mm")))]),t._v(" "),e.uid==t.currentUser.id?n("mu-button",{attrs:{icon:"",color:"#2196f3"},on:{click:function(n){t.currentTally=e,t.openSetTally=!0}}},[n("mu-icon",{attrs:{value:"rate_review"}})],1):t._e()],1)],1):t._e()})],2),t._v(" "),n("mu-divider")]})],2)],1),t._v(" "),n("settally",{attrs:{open:t.openSetTally,currentItem:t.currentTally},on:{"update:open":function(e){t.openSetTally=e}}}),t._v(" "),n("tallysetdrawer",{attrs:{open:t.openSetDrawer,searchForm:t.searchForm},on:{"update:open":function(e){t.openSetDrawer=e},"update:searchForm":function(e){t.searchForm=e}}}),t._v(" "),n("tallydrawer",{attrs:{open:t.openDrawer},on:{"update:open":function(e){t.openDrawer=e}}})],1)},staticRenderFns:[]};var J=n("VU/8")(Q,Z,!1,function(t){n("Orn+")},null,null).exports,tt={props:{righticon:{type:String},rightevent:{type:Function,default:function(){}},title:{type:String}},computed:h()({},Object(i.b)(["appbarStyle"]))},et={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("mu-appbar",{class:"top-van "+t.appbarStyle},[n("mu-button",{attrs:{slot:"left",icon:""},on:{click:function(e){t.$router.back(-1)}},slot:"left"},[n("mu-icon",{attrs:{value:"reply",left:""}})],1),t._v(" "),n("mu-button",{attrs:{slot:"right",icon:"",flat:""},on:{click:t.rightevent},slot:"right"},[t.righticon?n("mu-icon",{attrs:{value:t.righticon,left:""}}):t._e()],1),t._v("\n    "+t._s(t.title)+"\n  ")],1),t._v(" "),n("mu-container",{staticStyle:{position:"absolute",top:"65px"}},[t._t("default")],2)],1)},staticRenderFns:[]};var nt=n("VU/8")(tt,et,!1,function(t){n("nULK")},null,null).exports,at={components:{minor:nt},data:function(){return{searchValue:"",panel:"",oldSearchValue:[],list:[],searching:!1}},methods:{toggle:function(t){this.panel=t===this.panel?"":t},send:function(t,e,n){this.$store.dispatch("sendMessage",{tid:t,fid:this.currentUser.id,content:"向你发送了添加小伙伴的邀请",needTouch:!0,type:1})},search:function(){var t=this;t.searching=!0,t.$axios.get("/user/search/"+t.searchValue).then(function(e){if(0==e.code){var n=t.$linq(t.currentUser.partners).select(function(t){return t.id}).toArray();t.list=t.$linq(e.data).where(function(e){return n.indexOf(e.id)<0&&t.currentUser.id!=e.id}).toArray(),t.list.length<1&&t.$toast.info("可能你们已经是小伙伴了")}else t.list=[];t.oldSearchValue=[],t.searching=!1}).catch(function(){t.searching=!1})}},watch:{searchValue:function(t){var e=this;e.oldSearchValue.push(t),setTimeout(function(n){e.oldSearchValue.length>0&&t==e.oldSearchValue[e.oldSearchValue.length-1]&&(t?e.search():e.list=[])},500)}},computed:h()({},Object(i.b)(["currentUser"]))},it={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("minor",{attrs:{title:"添加小伙伴"}},[n("div",{staticStyle:{padding:"24px"}},[n("mu-text-field",{staticStyle:{width:"100%"},attrs:{label:"搜索对方的账号","action-icon":t.searching?"autorenew":"search"},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}}),n("br")],1),t._v(" "),n("div",{staticStyle:{padding:"0px 9px","margin-top":"-21px"}},t._l(t.list,function(e){return n("mu-expansion-panel",{key:e.id,attrs:{expand:t.panel===e.name},on:{change:function(n){t.toggle(e.name)}}},[n("div",{attrs:{slot:"header"},slot:"header"},[t._v(t._s(e.name))]),t._v(" "),n("mu-flex",{attrs:{"align-items":"center"}},[n("mu-list",{attrs:{textline:"two-line"}},[n("mu-list-item",{attrs:{avatar:"",ripple:!1,button:""}},[n("mu-list-item-action",[n("mu-avatar",[n("img",{attrs:{src:e.headImg}})])],1),t._v(" "),n("mu-list-item-content",[n("mu-list-item-title",[t._v(t._s(e.nick))]),t._v(" "),n("mu-list-item-sub-title",[t._v("\n                "+t._s(e.intro?e.intro:"这家伙很懒什么都没说")+"\n              ")])],1)],1)],1)],1),t._v(" "),n("mu-button",{attrs:{slot:"action",flat:"",color:"primary"},on:{click:function(n){t.send(e.id,e.nick,e.headImg)}},slot:"action"},[t._v("\n        发送邀请\n        "),n("mu-icon",{attrs:{left:"",value:"send"}})],1)],1)}))])},staticRenderFns:[]};var ot=n("VU/8")(at,it,!1,function(t){n("/QhK")},null,null).exports,st={props:{list:{type:Array,default:[]}},data:function(){return{openAlert:!1,currentItem:{}}},methods:{submit:function(){var t=this,e=this,n=e.$loading({});this.$axios.post("message/set",{ids:[e.currentItem.id],status:3}).then(function(a){0==a.code&&e.$toast.success("你们成为小伙伴啦"),n.close(),t.openAlert=!1}).catch(function(){n.close(),t.openAlert=!1})}},computed:{title:function(){if(this.list.length<1)return"";var t=new Date;return(this.list[0].ctime+"").substring(0,10)==this.$format(t,"yyyy-MM-dd").substring(0,10)?"今天":(t.setDate(t.getDate()-1),(this.list[0].ctime+"").substring(0,10)==this.$format(t,"yyyy-MM-dd").substring(0,10)?"昨天":(t.setDate(t.getDate()-1),(this.list[0].ctime+"").substring(0,10)==this.$format(t,"yyyy-MM-dd").substring(0,10)?"更早":void 0))}}},rt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.list.length>0?n("mu-list",{attrs:{textline:"two-line"}},[n("mu-sub-header",[t._v(t._s(t.title))]),t._v(" "),t._l(t.list,function(e){return n("mu-list-item",{key:e.id,attrs:{avatar:"",ripple:!1,button:""}},[n("mu-list-item-action",[n("mu-avatar",[n("img",{attrs:{src:e.fimg}})])],1),t._v(" "),n("mu-list-item-content",[n("mu-list-item-title",[t._v(t._s(e.fnick))]),t._v(" "),n("mu-list-item-sub-title",[n("span",{staticStyle:{color:"rgba(0, 0, 0, .87)"}},[t._v("\n          "+t._s(e.content)+"\n        ")])])],1),t._v(" "),n("mu-list-item-action",[n("mu-list-item-after-text",[t._v(t._s(t.$format(e.ctime,"hh:mm")))]),t._v(" "),1==e.type&&1==e.status?n("mu-button",{attrs:{icon:"",color:"primary"},on:{click:function(n){t.openAlert=!0,t.currentItem=e}}},[n("mu-icon",{attrs:{value:"sentiment_satisfied"}})],1):t._e(),t._v(" "),e.needTouch||1!=e.status?t._e():n("mu-button",{attrs:{icon:"",color:"error",ripple:!1}},[n("mu-icon",{attrs:{value:"lens",size:8}})],1)],1)],1)}),t._v(" "),"更早"!=t.title?n("mu-divider"):t._e(),t._v(" "),n("mu-dialog",{attrs:{title:"是否同意 ?",width:"75%","max-width":"75%","esc-press-close":!1,"overlay-close":!1,open:t.openAlert},on:{"update:open":function(e){t.openAlert=e}}},[n("span",{staticStyle:{color:"rgba(0,0,0,.87)"}},[t._v(t._s(t.currentItem.fnick)+" - ")]),t._v("\n    "+t._s(t.currentItem.content)+"\n    "),n("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:function(e){t.openAlert=!1}},slot:"actions"},[t._v("算了")]),t._v(" "),n("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:function(e){t.submit()}},slot:"actions"},[t._v("没问题")])],1)],2):t._e()},staticRenderFns:[]},lt={components:{minor:nt,messagelist:n("VU/8")(st,rt,!1,null,null,null).exports},data:function(){return{messageGroup:[],righticon:"",messages:[]}},methods:{submit:function(){var t=this,e=this,n=e.$loading({});this.$axios.post("/agreemessage",e.currentItem).then(function(a){0==a.code&&e.$toast.success("你们已经是小伙伴啦"),n.close(),t.openAlert=!1}).catch(function(){n.close(),t.openAlert=!1})},search:function(t){var e=this;e.$axios.post("/message/get",{type:0,status:0,pageIndex:1,pageSize:100}).then(function(t){0==t.code&&(e.messages=t.data,e.righticon=e.$linq(t.data).where(function(t){return!t.needTouch&&1==t.status}).toArray().length>0?"done_all":"",e.messageGroup=e.$linq(t.data).groupBy("r=>(r.ctime+'').substring(0,10)").select("{key:$.key(),value:$.toArray()}").toArray())})},readlyAll:function(){var t=this,e=t.$loading(),n=t.$linq(t.messages).select(function(t){return t.id}).toArray();t.$axios.post("message/set",{ids:n,status:2}).then(function(n){0==n.code&&t.$router.back(-1),e.close()}).catch(function(t){e.close()})}},computed:h()({},Object(i.b)(["currentUser"]),{todays:function(){var t=this,e=this.$linq(this.messageGroup).where(function(e){return e.key==t.$format(new Date,"yyyy-MM-dd").substring(0,10)}).toArray();return e.length>0?e[0].value:[]},yesterdays:function(){var t=this,e=new Date;e.setDate(e.getDate()-1);var n=this.$linq(this.messageGroup).where(function(n){return n.key==t.$format(e,"yyyy-MM-dd").substring(0,10)}).toArray();return n.length>0?n[0].value:[]},earlier:function(){var t=this,e=new Date;e.setDate(e.getDate()-1);var n=[];return this.$linq(this.messageGroup).where(function(n){return new Date(n.key)<new Date(t.$format(e,"yyyy-MM-dd").substring(0,10))}).select(function(t){return t.value}).toArray().forEach(function(t){t.forEach(function(t){n.push(t)})}),n}}),watch:{currentUser:function(){this.search(1)}},mounted:function(){}},ct={render:function(){var t=this.$createElement,e=this._self._c||t;return e("minor",{attrs:{title:"消息中心",righticon:this.righticon,rightevent:this.readlyAll}},[e("messagelist",{attrs:{list:this.todays}}),this._v(" "),e("messagelist",{attrs:{list:this.yesterdays}}),this._v(" "),e("messagelist",{attrs:{list:this.earlier}})],1)},staticRenderFns:[]},ut=n("VU/8")(lt,ct,!1,null,null,null).exports,mt={props:{server:{type:String,require:!0},api:{type:String,require:!0},params:{type:Object,default:function(){return{}}},filename:{type:String,default:"file"},file:{type:String,default:"",twoWay:!0},ext:{type:String,default:"jpg,gif,png"},header:{type:Object,default:function(){return{}}},limit:{type:Number,default:67108864},multiple:{type:Boolean,default:!0},preview:{type:Boolean,default:!0},auto:{type:Boolean,default:!0},crop:{type:Boolean,default:!1},width:{type:Number,default:200},height:{type:Number,default:200},ok:{type:String,default:"OK"},cancel:{type:String,default:"Cancel"},quality:{type:Number,default:.8},container:{type:String,default:""}},data:function(){return{isMobile:/(iphone|ios|android|iPad)/i.test(navigator.userAgent),percent:0,files:[],accepts:"",mimes:{jpg:"image/jpeg",png:"image/png",gif:"image/gif",mp4:"video/mp4",mov:"video/quicktime",wmv:"video/x-ms-wmv",flv:"video/x-flv",svg:"image/svg+xml",psd:"image/photoshop",mp3:"audio/mpeg",rar:"application/x-rar-compressed",zip:"application/zip",json:"application/json",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",doc:"application/msword",pdf:"application/pdf",xls:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint"},scrollbar:null,input:null,cropHeight:0,cropTop:0,showCrop:!1,showCropDialog:!1,scale:100,scaleX:0,scaleY:0,scaleLength:0,scaleWidth:0,scaleHeight:0,drag:!1,grabbing:!1,beginX:0,beginY:0,beginLength:0,img:null,canvas:null,context:null}},watch:{percent:function(){var t=this;100===this.percent&&setTimeout(function(){t.percent=0},500)},auto:function(){this.auto&&(this.uploadFiles(),this.auto=!1)}},ready:function(){this.crop&&(this.multiple=!1,this.ext="jpg",this.auto=!1);for(var t=[],e=this.ext.split(","),n=0;n<e.length;n++)t.push(this.mimes[e[n]]);this.accepts=t.join(",")},methods:{fileChange:function(t){var e=this;if(this.input=t.target,this.crop){if(0===t.target.files.length)return!1;this.showCrop=!0,this.showCropDialog=!1;var n=new window.FileReader;n.onload=function(t){e.img=new window.Image,e.img.src=n.result,e.img.onload=function(){""===e.container?"hidden"===window.getComputedStyle(document.body).overflow?e.scrollbar=document.querySelector(".router"):e.scrollbar=document.body:e.scrollbar=document.querySelector(e.container);var t=e.scrollbar.scrollHeight,a=window.innerHeight;t<=a?(e.cropHeight=a,e.cropTop=~~(a-(e.height+50))/2):(e.cropHeight=t,e.cropTop=~~((a-(e.height+50))/2)),e.img.naturalWidth>e.img.naturalHeight?(e.scaleHeight=e.height,e.scaleWidth=Math.round(e.scaleHeight*e.img.naturalWidth/e.img.naturalHeight)):(e.scaleWidth=e.width,e.scaleHeight=Math.round(e.scaleWidth*e.img.naturalHeight/e.img.naturalWidth)),e.scaleX=-Math.round((e.scaleWidth-e.width)/2),e.scaleY=-Math.round((e.scaleHeight-e.height)/2),e.cropImage=n.result,e.canvas=document.createElement("canvas"),e.canvas.width=e.width,e.canvas.height=e.height,e.canvas.setAttribute("style","position:absolute;left:0;top:0;opacity:0;z-index:99999"),e.context=e.canvas.getContext("2d"),e.cropToCanvas(),document.body.appendChild(e.canvas),e.showCropDialog=!0}},n.readAsDataURL(t.target.files[0])}else this.files=[],this.getFiles(t),this.auto&&this.uploadFiles()},getFiles:function(t){var e=this;t.stopPropagation(),t.preventDefault(),this.files=t.target.files||t.dataTransfer.files;var n=this.ext.split(","),a=[];n.length>0&&n.forEach(function(t){void 0!==e.mimes[t]&&a.push(e.mimes[t])});for(var i=0;this.files[i];i++)(this.files[i].size>this.limit||!a.includes(this.files[i].type))&&this.removeFile(this.files[i].name)},removeFile:function(t){for(var e=[],n=0;this.files[n];n++)this.files[n].name!==t&&e.push(this.files[n]);this.files=e},uploadFiles:function(){var t=this;if(0===this.files.length)return!1;for(var e=0;this.files[e];e++)!function(e){var n=new window.XMLHttpRequest;if(n.upload){var a=new window.FormData;if(a.append(t.filename,e),void 0!==t.params)for(var i in t.params)a.append(i,t.params[i]);if(n.upload.addEventListener("progress",function(e){t.percent=Math.floor(e.loaded/e.total*100),console.log("uploadProgress",t.percent)},!1),n.onreadystatechange=function(e){if(4===n.readyState){var a=n.responseText;200===n.status?("{"===a.substr(0,1)&&(a=JSON.parse(a)),void 0!==a.result&&(t.file=a.result),t.$emit("success"),0===t.files.length&&console.log("uploadDone")):console.log("uploadError",a)}},n.open("POST",t.server+t.api,!0),void 0!==t.header)for(var o in t.header)n.setRequestHeader(o,t.header[o]);n.withCredentials=!1,n.send(a)}}(this.files[e])},cropDragBegin:function(t){this.drag=!0,this.grabbing=!0,this.beginX=t.pageX-t.target.offsetLeft,this.beginY=t.pageY-t.target.offsetTop,this.isMobile?(2===t.touches.length&&(this.beginLength=0===this.beginLength?this.cropTouchData(t).length:this.beginLength),document.addEventListener("touchmove",this.cropDragMove,!1),document.addEventListener("touchend",this.cropDragEnd,!1)):(document.addEventListener("mouseover",this.cropDragMove,!1),document.addEventListener("mouseup",this.cropDragEnd,!1))},cropDragMove:function(t){if(!this.drag)return!1;this.isMobile&&2===t.touches.length?(this.scaleLength=this.cropTouchData(t).length,this.scale=Math.min(200,Math.max(100,this.scaleLength/this.beginLength*100)),this.cropZoom()):(this.scaleX=t.pageX-this.beginX,this.scaleY=t.pageY-this.beginY),this.cropLimit()},cropDragEnd:function(t){this.drag=!1,this.grabbing=!1,this.cropToCanvas(),this.isMobile?(document.removeEventListener("touchmove",this.cropDragMove,!1),document.removeEventListener("touchend",this.cropDragEnd,!1)):(document.removeEventListener("mouseover",this.cropDragMove,!1),document.removeEventListener("mouseup",this.cropDragEnd,!1))},cropToCanvas:function(){this.context.clearRect(0,0,this.width,this.height);var t=Math.round(Math.abs(this.scaleX)*this.img.naturalWidth/this.scaleWidth),e=Math.round(Math.abs(this.scaleY)*this.img.naturalHeight/this.scaleHeight),n=this.width*this.img.naturalWidth/this.scaleWidth,a=this.height*this.img.naturalHeight/this.scaleHeight;this.context.drawImage(this.img,t,e,n,a,0,0,this.width,this.height/this.cropGetRatio())},cropZoom:function(){var t=this.scale/100,e=this.scaleX-this.width/2,n=this.scaleY-this.height/2,a=void 0;this.img.naturalWidth>this.img.naturalHeight?(a=this.scaleHeight/this.height,this.scaleHeight=this.height*t,this.scaleWidth=this.scaleHeight*this.img.naturalWidth/this.img.naturalHeight):(a=this.scaleWidth/this.width,this.scaleWidth=this.width*t,this.scaleHeight=this.scaleWidth*this.img.naturalHeight/this.img.naturalWidth),this.scaleX=e*t/a+this.width/2,this.scaleY=n*t/a+this.height/2,this.cropLimit(),this.cropToCanvas()},cropTouchData:function(t){if(!(t.touches.length<2)){var e=t.touches[0].pageX,n=t.touches[1].pageX,a=e<=n?(n-e)/2+e:(e-n)/2+n,i=t.touches[0].pageY-this.scrollbar.scrollTop,o=t.touches[1].pageY-this.scrollbar.scrollTop,s=i<=o?(o-i)/2+i:(i-o)/2+o;return{length:Math.round(Math.sqrt(Math.pow(e-n,2)+Math.pow(i-o,2))),x:Math.round(a),y:Math.round(s)}}},cropLimit:function(){this.scaleX<-(this.scaleWidth-this.width)&&(this.scaleX=-(this.scaleWidth-this.width)),this.scaleY<-(this.scaleHeight-this.height)&&(this.scaleY=-(this.scaleHeight-this.height)),this.scaleX>0&&(this.scaleX=0),this.scaleY>0&&(this.scaleY=0),this.scaleHeight===this.height&&(this.scaleY=0),this.scaleWidth===this.width&&(this.scaleX=0)},cropOK:function(){var t=this,e=this.canvas.toDataURL("image/jpeg",this.quality||.8);if(""===this.server||""===this.api)return this.$emit("input",e),this.showCrop=!1,document.body.removeChild(this.canvas),this.input.value="",!1;e=window.atob(e.split(",")[1]);for(var n=new ArrayBuffer(e.length),a=new Uint8Array(n),i=0;i<e.length;i++)a[i]=e.charCodeAt(i);var o=new window.Blob([a],{type:"image/jpeg"});o.filename="blob.jpg";var s=new window.FormData;if(s.append(this.filename,o,"blob.jpg"),void 0!==this.params)for(var r in this.params)s.append(r,this.params[r]);var l=new window.XMLHttpRequest;if(l.upload){if(l.upload.addEventListener("progress",function(e){t.percent=Math.floor(e.loaded/e.total*100),console.log("uploadProgress",t.percent)},!1),l.onreadystatechange=function(n){if(4===l.readyState)if(200===l.status){var a=JSON.parse(l.responseText);t.$emit("success",a),0===t.files.length&&console.log("uploadDone")}else console.log("uploadError",e)},l.open("POST",this.server+this.api,!0),void 0!==this.header)for(var c in this.header)l.setRequestHeader(c,this.header[c]);l.withCredentials=!1,l.send(s)}this.showCrop=!1,document.body.removeChild(this.canvas),this.input.value=""},cropCancel:function(){this.showCrop=!1,document.body.removeChild(this.canvas),this.input.value=""},cropGetRatio:function(){var t=this.img.naturalHeight,e=document.createElement("canvas");e.width=1,e.height=t;var n=e.getContext("2d");n.drawImage(this.img,0,0);for(var a=n.getImageData(0,0,1,t).data,i=0,o=t,s=t;s>i;){0===a[4*(s-1)+3]?o=s:i=s,s=o+i>>1}var r=s/t;return 0===r?1:r}}},pt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"upload"},[t._t("default"),t._v(" "),""!=t.file&&t.preview?n("div",{staticClass:"image",style:{"background-image":"url("+t.server+t.file+")"}}):t._e(),t._v(" "),t.percent>0?n("div",{staticClass:"progress"},[n("span",{style:{width:t.percent+"%"}}),t._v(" "),n("em",{staticClass:"pa"},[t._v(t._s(t.percent)+"%")])]):t._e(),t._v(" "),n("input",{staticClass:"upload",attrs:{type:"file",accept:t.accepts,multiple:t.multiple},on:{change:t.fileChange}}),t._v(" "),t.showCrop?n("div",{staticClass:"crop",style:{height:t.cropHeight+"px"},attrs:{transition:"crop"}},[t.showCropDialog?t._e():n("div",{staticClass:"loading"},[n("div",{staticClass:"v-beat v-beat-odd"}),t._v(" "),n("div",{staticClass:"v-beat v-beat-even"}),t._v(" "),n("div",{staticClass:"v-beat v-beat-odd"})]),t._v(" "),t.showCropDialog?n("div",{staticClass:"dialog",style:{width:t.width+"px",top:t.cropTop+"px"}},[n("section",{class:{grab:0==t.grabbing,grabbing:t.grabbing},style:{width:t.width+"px",height:t.height+"px"}},[n("img",{style:{width:t.scaleWidth+"px",height:t.scaleHeight+"px",left:t.scaleX+"px",top:t.scaleY+"px"},attrs:{src:t.cropImage},on:{mousedown:function(e){return e.preventDefault(),t.cropDragBegin(e)},mousemove:function(e){return e.preventDefault(),t.cropDragMove(e)},mouseup:function(e){return e.preventDefault(),t.cropDragEnd(e)},touchstart:function(e){return e.preventDefault(),t.cropDragBegin(e)},touchmove:function(e){return e.preventDefault(),t.cropDragMove(e)},touchend:function(e){return e.preventDefault(),t.cropDragEnd(e)}}})]),t._v(" "),n("footer",[n("button",{on:{click:t.cropCancel}},[t._v(t._s(t.cancel))]),t._v(" "),n("button",{on:{click:t.cropOK}},[t._v(t._s(t.ok))])]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.scale,expression:"scale"}],attrs:{type:"range",min:"100",max:"200",step:"1"},domProps:{value:t.scale},on:{input:t.cropZoom,__r:function(e){t.scale=e.target.value}}})]):t._e()]):t._e()],2)},staticRenderFns:[]};var ht={components:{upload:n("VU/8")(mt,pt,!1,function(t){n("wIZv")},"data-v-692eb8e8",null).exports},data:function(){return{upload:{server:"http://118.24.27.231:81",api:"/uploadfile",params:{id:"123",fileName:"123"},crop:!0,width:500,height:500,cancel:"取消",ok:"确定",filename:"files",ext:"jpg,png"}}},methods:{upsuccess:function(t){console.log("success")}}},dt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("upload",{attrs:{server:t.upload.server,api:t.upload.api,filename:t.upload.filename,params:t.upload.params,crop:!0,width:t.upload.width,height:t.upload.height,ok:t.upload.ok,cancel:t.upload.cancel,auto:!0,quality:.5,ext:t.upload.ext},on:{success:t.upsuccess}},[n("mu-icon",{attrs:{value:"cloud_upload"}})],1)],1)},staticRenderFns:[]},ft=n("VU/8")(ht,dt,!1,null,null,null).exports;a.a.use(l.a);var gt=new l.a({routes:[{path:"/sign",name:"Sign",component:m},{path:"/",name:"Home",component:C},{path:"/tally",name:"Tally",component:J},{path:"/me",name:"Me",component:j},{path:"/addpartner",Name:"AddPartner",component:ot},{path:"/message",Name:"Message",component:ut},{path:"/testupload",Name:"testupload",component:ft}]}),vt=n("aFc6");n("E51W");a.a.use(i.a);var yt=new i.a.Store({state:{currentUser:{},appbarStyle:"",unreadNumber:0},mutations:{changeUser:function(t,e){t.currentUser=e},changeAppbarStyle:function(t,e){t.appbarStyle=e},changeUnreadNumber:function(t,e){t.unreadNumber=e}},actions:{initUser:function(t,e){var n=t.commit,a=this._vm,i=this;a.$axios.get("/user/get").then(function(t){0==t.code?(t.data.consumes=a.$linq(t.data.consumes).orderByDescending(function(t){return t.count}).thenByDescending(function(t){return new Date(t.utime)}).thenByDescending(function(t){return new Date(t.ctime)}).toArray(),n("changeUser",t.data),i.dispatch("initUnreadNumber")):(a.$toast.warning("token失效,稍后将跳转到登陆页面"),t&&setTimeout(function(){e.$router.push({path:"/sign"})},1200))})},sendMessage:function(t,e){t.commit;var n=this._vm,a=n.$loading({});n.$axios.post("/message/add",{tid:e.tid,fid:this.state.currentUser.id,content:e.content,needTouch:e.needTouch,type:e.type,status:1}).then(function(t){0==t.code&&n.$toast.success("已发送"),a.close()})},initUnreadNumber:function(t){var e=t.commit;this.state.currentUser.id&&this._vm.$axios.get("/message/getcount/1").then(function(t){0==t.code&&e("changeUnreadNumber",t.data)})}}}),bt=(n("7SuA"),n("sXio")),_t=(n("0Y+k"),n("1kwf")),xt=n("+nBf"),wt=n.n(xt),kt=n("//Fk"),$t=n.n(kt),Ft=n("mtWM"),St=n.n(Ft),Dt=n("PrNn"),Mt=n.n(Dt);location.href.endsWith("test")?St.a.defaults.baseURL="http://localhost":St.a.defaults.baseURL="http://104.129.180.51:8888",St.a.interceptors.request.use(function(t){return t.headers={"Content-Type":"application/json",token:localStorage.getItem("token")},t},function(t){return bt.a.error("系统错误"),console.log(t),$t.a.reject(t)}),St.a.interceptors.response.use(function(t){return 0!=t.data.code?bt.a.warning(t.data.msg):t.data.data&&t.data.data.token&&localStorage.setItem("token",t.data.data.token),t.data},function(t){return bt.a.error("系统错误"),console.log(t),$t.a.reject(t)}),a.a.prototype.$fileUrl="http://118.24.27.231:81/uploadfile",a.a.prototype.$axios=St.a,a.a.prototype.$linq=Mt.a.from,a.a.prototype.$format=function(t,e){var n=new Date(t),a={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[i]:("00"+a[i]).substr((""+a[i]).length)));return e},a.a.prototype.$numberFormat=function(t){t=(t+"").replace(/[^0-9+-Ee.]/g,"");var e=isFinite(+t)?+t:0,n=isFinite(1)?Math.abs(1):0,a="";a=(n?function(t,e){var n=Math.pow(10,e);return""+Math.floor(t*n)/n}(e,n):""+Math.floor(e)).split(".");for(var i=/(-?\d+)(\d{3})/;i.test(a[0]);)a[0]=a[0].replace(i,"$1,$2");return(a[1]||"").length<n&&(a[1]=a[1]||"",a[1]+=new Array(n-a[1].length+1).join("0")),a.join(".")},a.a.use(vt.a),a.a.use(bt.a),a.a.use(_t.a),a.a.use(wt.a),new a.a({el:"#app",router:gt,store:yt,components:{App:r},template:"<App/>"})},uPa8:function(t,e){},wIZv:function(t,e){},xA82:function(t,e){},yjky:function(t,e,n){"use strict";var a={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"container",staticClass:"g-core-image-upload-btn"},[t._t("default",[t._v(t._s(t.text))]),t._v(" "),n("form",{directives:[{name:"show",rawName:"v-show",value:!t.hasImage,expression:"!hasImage"}],staticClass:"g-core-image-upload-form",attrs:{method:"post",enctype:"multipart/form-data",action:""}},[n("input",{staticStyle:{width:"100%",height:"100%"},attrs:{disabled:t.uploading,id:"g-core-upload-input-"+t.formID,name:t.name,multiple:t.multiple,type:"file",accept:t.inputAccept},on:{change:t.change,dragover:t.dragover,dragenter:t.dragover,dragleave:t.dragleave,dragend:t.dragleave,drop:t.dragleave}})]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.hasImage,expression:"hasImage"}],staticClass:"g-core-image-corp-container",attrs:{id:"vciu-modal-"+t.formID}},[n("crop",{ref:"cropBox",attrs:{"is-resize":t.resize&&!t.crop,ratio:t.cropRatio,"is-rotate":t.rotate}}),t._v(" "),n("div",{staticClass:"info-aside"},[n("p",{staticClass:"btn-groups rotate-groups",staticStyle:{display:"none"}},[n("button",{staticClass:"btn btn-rotate",attrs:{type:"button"},on:{click:t.doRotate}},[t._v("↺")]),t._v(" "),n("button",{staticClass:"btn btn-reverserotate",attrs:{type:"button"},on:{click:t.doReverseRotate}},[t._v("↻")])]),t._v(" "),t.crop?n("p",{staticClass:"btn-groups"},[n("button",{staticClass:"btn btn-upload",attrs:{type:"button"},on:{click:t.doCrop}},[t._v(t._s(t.cropBtn.ok))]),t._v(" "),n("button",{staticClass:"btn btn-cancel",attrs:{type:"button"},on:{click:t.cancel}},[t._v(t._s(t.cropBtn.cancel))])]):t._e(),t._v(" "),t.resize&&!t.crop?n("p",{staticClass:"btn-groups"},[n("button",{staticClass:"btn btn-upload",attrs:{type:"button"},on:{click:t.doResize}},[t._v(t._s(t.ResizeBtn.ok))]),t._v(" "),n("button",{staticClass:"btn btn-cancel",attrs:{type:"button"},on:{click:t.cancel}},[t._v(t._s(t.ResizeBtn.cancel))])]):t._e()])],1)],2)},staticRenderFns:[]};e.a=a}},["sq7P"]);
//# sourceMappingURL=app.fc6cbc89a6dd429a5652.js.map